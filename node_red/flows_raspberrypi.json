[{"type":"tab","id":"8086332d.7f79d","label":"Sonar & Skull"},{"type":"tab","id":"472cf557.b8d30c","label":"Levers & tracking"},{"type":"tab","id":"6b6420fc.949be","label":"Player coming or going"},{"type":"tab","id":"2520088d.dadff8","label":"control it"},{"id":"bdf988ea.420678","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":""},{"id":"e9b0ee1b.164f1","type":"twitter-credentials","screen_name":"@gunder"},{"id":"f2f40b3e.0d0bf8","type":"mqtt in","name":"/arduino/2/sonar","topic":"/arduino/2/sonar","broker":"bdf988ea.420678","x":110.99999237060547,"y":35.285715103149414,"z":"8086332d.7f79d","wires":[["7cf3398a.830cc8"]]},{"id":"f99edcd9.06612","type":"switch","name":"person is close","property":"payload","rules":[{"t":"lte","v":"40"},{"t":"else"}],"checkall":"true","outputs":2,"x":583.7142486572266,"y":37.00000190734863,"z":"8086332d.7f79d","wires":[["5e52110f.a1adf"],[]]},{"id":"7cf3398a.830cc8","type":"function","name":"Get distance","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//Returns the number after the \":\"\n\ncolonpos=msg.payload.indexOf(\":\");\ntemp=msg.payload.slice(colonpos+1);\nconsole.log(temp);\nmsg.payload=temp;\nreturn msg;","outputs":1,"x":340.71428298950195,"y":36.85714149475098,"z":"8086332d.7f79d","wires":[["f99edcd9.06612"]]},{"id":"869be270.79642","type":"function","name":"LEDs ON","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_ON\"\nreturn msg;","outputs":1,"x":578.5714225769043,"y":244.4285717010498,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"7b381c64.84c7e4","type":"delay","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":137.42855834960938,"y":251.2380828857422,"z":"8086332d.7f79d","wires":[["c6236151.39dca","aabe5e5f.5541a"]]},{"id":"30642d65.cf9bd2","type":"function","name":"Turn Left","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"SERVOS_MOVE, 190, 235, 7\"\nreturn msg;","outputs":1,"x":396.1428756713867,"y":306.28572177886963,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"71c90ff6.8e36f","type":"mqtt out","name":"","topic":"/arduino/1/incoming","broker":"bdf988ea.420678","x":682.4286193847656,"y":499.9999780654907,"z":"8086332d.7f79d","wires":[]},{"id":"c6236151.39dca","type":"delay","name":"delay 2","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":107,"y":426,"z":"8086332d.7f79d","wires":[["dda216fc.225de8","98b77e1f.67488","12986cd2.ed6793","3a91ba0.fc56e46"]]},{"id":"dda216fc.225de8","type":"function","name":"laugh","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LAUGH\";\n\nreturn msg;","outputs":1,"x":180.1428451538086,"y":631.0000238418579,"z":"8086332d.7f79d","wires":[["1a1ba421.e5e45c"]]},{"id":"1a1ba421.e5e45c","type":"mqtt out","name":"","topic":"/raspberry/1/incoming","broker":"bdf988ea.420678","x":345.00000762939453,"y":576.7143020629883,"z":"8086332d.7f79d","wires":[]},{"id":"98b77e1f.67488","type":"function","name":"Jaw motion","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"JAW_MOTION,4,1\"\nreturn msg;","outputs":1,"x":354.14283752441406,"y":426.2857151031494,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"12986cd2.ed6793","type":"delay","name":"","pauseType":"delay","timeout":"3500","timeoutUnits":"milliseconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":100.71428680419922,"y":704.9999704360962,"z":"8086332d.7f79d","wires":[["8a3fd4db.75c028","7c89215d.8376e"]]},{"id":"8a3fd4db.75c028","type":"function","name":"Turn Back","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"SERVOS_MOVE, 360, 320, 7\"\nreturn msg;","outputs":1,"x":304.0000114440918,"y":704.2856845855713,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"7c89215d.8376e","type":"delay","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":102.85714340209961,"y":851.4285659790039,"z":"8086332d.7f79d","wires":[["45943504.ba6bcc","57ae1ec.fa851e"]]},{"id":"45943504.ba6bcc","type":"function","name":"LEDs OFF","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_OFF\"\nreturn msg;","outputs":1,"x":298.5714349746704,"y":800.0000295639038,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"3badbf61.c4524","type":"inject","name":"distance: 30","topic":"/arduino/2/sonar","payload":"ping: 29","payloadType":"string","repeat":"","crontab":"","once":false,"x":114.28571428571428,"y":92.85714285714285,"z":"8086332d.7f79d","wires":[["7cf3398a.830cc8"]]},{"id":"3a91ba0.fc56e46","type":"delay","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":262.8571243286133,"y":501.4285717010498,"z":"8086332d.7f79d","wires":[["6390ff3c.9c6f"]]},{"id":"6390ff3c.9c6f","type":"function","name":"LEDs ON","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_ON\"\nreturn msg;","outputs":1,"x":407.1428527832031,"y":500.00000047683716,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"aabe5e5f.5541a","type":"function","name":"Turn right","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"SERVOS_MOVE, 550, 235, 7\";\nreturn msg;","outputs":1,"x":398.57143783569336,"y":235.71429538726807,"z":"8086332d.7f79d","wires":[["71c90ff6.8e36f"]]},{"id":"ebc5d47a.143a28","type":"mqtt in","name":"","topic":"/minecraft/+/skull/#","broker":"bdf988ea.420678","x":100.42857360839844,"y":73.42856788635254,"z":"6b6420fc.949be","wires":[["7b72cb4.f848d34"]]},{"id":"8b0a2955.74f5d8","type":"switch","name":"Coming or going?","property":"payload","rules":[{"t":"cont","v":"COMPANY"},{"t":"cont","v":"ALONE"}],"checkall":"true","outputs":2,"x":327.1428527832031,"y":166.14285850524902,"z":"6b6420fc.949be","wires":[["14cfe665.eb301a","3d211ddd.c2dee2"],["403ee1e.fbfc12","3297397a.cd68c6"]]},{"id":"6aeef1ef.95111","type":"function","name":"Say Hello","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"HELLO\"\nreturn msg;","outputs":1,"x":549.8572387695312,"y":549.5714302062988,"z":"6b6420fc.949be","wires":[["9e77c3c2.61884"]]},{"id":"9e77c3c2.61884","type":"mqtt out","name":"","topic":"/raspberry/1/incoming","broker":"bdf988ea.420678","x":1094.428565979004,"y":428.00003814697266,"z":"6b6420fc.949be","wires":[]},{"id":"ec2bb0d.f13d45","type":"mqtt out","name":"","topic":"/arduino/1/incoming","broker":"bdf988ea.420678","x":1100.0477294921875,"y":619.3809509277344,"z":"6b6420fc.949be","wires":[]},{"id":"14cfe665.eb301a","type":"function","name":"Skull neutral position","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"SERVO_NEUTRAL\"\nreturn msg;","outputs":1,"x":586.2857055664062,"y":362.2856979370117,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45","9661e5d6.699e18"]]},{"id":"9661e5d6.699e18","type":"function","name":"LEDs ON","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_ON\"\nreturn msg;","outputs":1,"x":593.1427764892578,"y":243.28571891784668,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45"]]},{"id":"3fc30d16.c03cf2","type":"function","name":"Skull Talk","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"JAW_MOTION,4,1\"\nreturn msg;","outputs":1,"x":570.7142753601074,"y":124.85712814331055,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45","a6c5c38e.593a4","73052b03.8cfad4"]]},{"id":"a6c5c38e.593a4","type":"function","name":"LEDs ON","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_ON\"\nreturn msg;","outputs":1,"x":766.7142562866211,"y":123.99999046325684,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45"]]},{"id":"403ee1e.fbfc12","type":"function","name":"Skull neutral position","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"SERVO_NEUTRAL\"\nreturn msg;","outputs":1,"x":537.2857284545898,"y":699.4285883903503,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45","b08aa188.4f756"]]},{"id":"3297397a.cd68c6","type":"function","name":"Say Goodbye","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"GOODBYE\"\nreturn msg;","outputs":1,"x":554.2857513427734,"y":615.7142848968506,"z":"6b6420fc.949be","wires":[["9e77c3c2.61884"]]},{"id":"b08aa188.4f756","type":"function","name":"Skull Talk","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"JAW_MOTION,4,1\"\nreturn msg;","outputs":1,"x":534.2857262747627,"y":778.5714294569832,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45","73052b03.8cfad4"]]},{"id":"c923c103.36dc4","type":"inject","name":"Has company","topic":"","payload":"HAS_COMPANY","payloadType":"string","repeat":"","crontab":"","once":false,"x":104.28571701049805,"y":202.85713005065918,"z":"6b6420fc.949be","wires":[["7b72cb4.f848d34"]]},{"id":"b1c29a9f.4e3d68","type":"inject","name":"Is Alone","topic":"","payload":"IS_ALONE","payloadType":"string","repeat":"","crontab":"","once":false,"x":92.85713577270508,"y":270.00000381469727,"z":"6b6420fc.949be","wires":[["7b72cb4.f848d34"]]},{"id":"3d211ddd.c2dee2","type":"delay","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":569.9999732971191,"y":38.57142162322998,"z":"6b6420fc.949be","wires":[["6aeef1ef.95111","3fc30d16.c03cf2"]]},{"id":"fd7fc719.028038","type":"mqtt in","name":"","topic":"/minecraft/+/block/#","broker":"bdf988ea.420678","x":98.57142639160156,"y":861.4285831451416,"z":"6b6420fc.949be","wires":[["48e66f62.b7199"]]},{"id":"a43c4e90.5bc3b","type":"function","name":"Say Doh","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"DOH\"\nreturn msg;","outputs":1,"x":545.7142857142857,"y":878.5714285714284,"z":"6b6420fc.949be","wires":[["9e77c3c2.61884"]]},{"id":"cfef43dd.3010c","type":"function","name":"Skull shout","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"JAW_MOTION,1,1\"\nreturn msg;","outputs":1,"x":554.2857131958008,"y":941.4285383224487,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45","59a9c827.a65638","f19af68f.0e6508"]]},{"id":"952bb36d.6ad45","type":"inject","name":"Break block","topic":"","payload":"","payloadType":"string","repeat":"","crontab":"","once":false,"x":108.5714340209961,"y":793.0952663421631,"z":"6b6420fc.949be","wires":[["48e66f62.b7199"]]},{"id":"99e72c16.6618d","type":"mqtt in","name":"","topic":"/minecraft/+/lever/#","broker":"bdf988ea.420678","x":142.8571434020996,"y":91.42857456207275,"z":"472cf557.b8d30c","wires":[["89c0cc60.763f3"]]},{"id":"89c0cc60.763f3","type":"function","name":"Which Eye & Pos","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nvar cmd=\"LED, 1,\";\nif(msg.topic.indexOf(\"249\")>0){\n\tcmd=\"LED, 0,\";\n}\n\nmsg.payload=cmd.concat(msg.payload);\n\nreturn msg;","outputs":1,"x":407.1428527832031,"y":91.42856025695801,"z":"472cf557.b8d30c","wires":[["82f97609.7d0688"]]},{"id":"82f97609.7d0688","type":"mqtt out","name":"","topic":"/arduino/1/incoming","broker":"bdf988ea.420678","x":985.7143096923828,"y":172.85713577270508,"z":"472cf557.b8d30c","wires":[]},{"id":"af9be54b.506418","type":"inject","name":"one eye on","topic":"/minecraft/world/lever/249","payload":"1","payloadType":"string","repeat":"","crontab":"","once":false,"x":144.28571428571428,"y":172.85714285714283,"z":"472cf557.b8d30c","wires":[["89c0cc60.763f3"]]},{"id":"ce79f738.318608","type":"inject","name":"one eye off","topic":"/minecraft/world/lever/249","payload":"0","payloadType":"string","repeat":"","crontab":"","once":false,"x":144.28572463989258,"y":205.71428871154785,"z":"472cf557.b8d30c","wires":[["89c0cc60.763f3"]]},{"id":"aee10d4e.511ef","type":"inject","name":"Other eye on","topic":"/minecraft/world/lever/250","payload":"1","payloadType":"string","repeat":"","crontab":"","once":false,"x":145.71429824829102,"y":240.0000171661377,"z":"472cf557.b8d30c","wires":[["89c0cc60.763f3"]]},{"id":"73d7fb04.8c2804","type":"inject","name":"Other eye off","topic":"/minecraft/world/lever/250","payload":"0","payloadType":"string","repeat":"","crontab":"","once":false,"x":145.71429061889648,"y":274.28571701049805,"z":"472cf557.b8d30c","wires":[["89c0cc60.763f3"]]},{"id":"d565bafe.2a9a48","type":"mqtt in","name":"","topic":"/minecraft/+/facetracker/#","broker":"bdf988ea.420678","x":151.4285659790039,"y":415.7142925262451,"z":"472cf557.b8d30c","wires":[["f6bc1ac5.0943e8"]]},{"id":"6ac5d78a.953a28","type":"function","name":"Translate","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//require('util');\n\nvar    servoXMin=200; // 13 The commented numbers are for the old pan/tilt set\nvar    servoXMax=520; // 133\nvar    servoXMid=360; // 73\nvar    servoYMin=235; // 33\nvar     servoYMax=520; // 80\nvar    servoYMid=320; // 65\n\nvar parts=msg.payload.split(\",\");\n\nvar servoX=0.0;\nvar servoY=0.0;\n\n    var X=Math.floor(servoXMid-parts[0]*180);    // Allow for calibration\n    if(X<servoXMin)                 \t  // The skull is heavy. not too big turns\n        servoX=servoXMin;\n    else if (X>servoXMax)\n        servoX=servoXMax;\n    else\n        servoX=X;\n\n    var Y=Math.floor(servoYMid-parts[1]*180-20);     // I subtract 20 since the skull is mounted with a low pitch\n    if(Y<servoYMin)                 \t\t // The skull is heavy. Not too big pitch\n        servoY=servoYMin;\n    else if (Y>servoYMax)\n        servoY=servoYMax;\n    else\n        servoY=Y;\n\ncontext.global.servoY=servoY;\ncontext.global.servoX=servoX;\n\nmsg.payload=util.format(\"SERVOS_MOVE,%d,%d,3\",servoX,servoY);\n\nreturn msg;","outputs":1,"x":745.7143440246582,"y":414.285737991333,"z":"472cf557.b8d30c","wires":[["82f97609.7d0688","58aa7d2e.a75584"]]},{"id":"f2174474.0de8b8","type":"inject","name":"leftup","topic":"/minecraft/world/facetracker/45,34","payload":"-0.5,0.5","payloadType":"string","repeat":"","crontab":"","once":false,"x":127.14285714285712,"y":521.4285714285713,"z":"472cf557.b8d30c","wires":[["f6bc1ac5.0943e8"]]},{"id":"5119103a.aee6f","type":"inject","name":"rightup","topic":"/minecraft/world/facetracker/45,34","payload":"0.5,0.5","payloadType":"string","repeat":"","crontab":"","once":false,"x":127.14285278320312,"y":591.4285697937012,"z":"472cf557.b8d30c","wires":[["f6bc1ac5.0943e8"]]},{"id":"5e52110f.a1adf","type":"function","name":"test and set busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nif (typeof context.global.busy === \"undefined\") {\n\tcontext.global.busy=true;\n\tmsg.freeToRun=true;\n} else {\n\tif(context.global.busy){\n\t\tmsg.freeToRun=false;\t\t\t// prevent further execution\n\t} else {\n\t\tcontext.global.busy=true;\n\t\tmsg.freeToRun=true;\n\t}\n}\nreturn msg;","outputs":1,"x":349.99998474121094,"y":105.71427822113037,"z":"8086332d.7f79d","wires":[["b8eb4dc6.4714b"]]},{"id":"b8eb4dc6.4714b","type":"switch","name":"Ok to run?","property":"freeToRun","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":564.2857055664062,"y":105.71428203582764,"z":"8086332d.7f79d","wires":[["7b381c64.84c7e4","869be270.79642"]]},{"id":"57ae1ec.fa851e","type":"function","name":"set not busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\ncontext.global.busy=false;\nreturn msg;","outputs":1,"x":635.9524230957031,"y":846.6666107177734,"z":"8086332d.7f79d","wires":[[]]},{"id":"f6bc1ac5.0943e8","type":"function","name":"test and set busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nif (typeof context.global.busy === \"undefined\") {\n\tcontext.global.busy=true;\n\tmsg.freeToRun=true;\n} else {\n\tif(context.global.busy){\n\t\tmsg.freeToRun=false;\t\t\t// prevent further execution\n\t} else {\n\t\tcontext.global.busy=true;\n\t\tmsg.freeToRun=true;\n\t}\n}\nreturn msg;","outputs":1,"x":427.14288330078125,"y":414.2856979370117,"z":"472cf557.b8d30c","wires":[["265226cc.d9adda"]]},{"id":"265226cc.d9adda","type":"switch","name":"Ok to run?","property":"freeToRun","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":601.4285430908203,"y":414.2857027053833,"z":"472cf557.b8d30c","wires":[["6ac5d78a.953a28"]]},{"id":"58aa7d2e.a75584","type":"function","name":"set not busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\ncontext.global.busy=false;\nreturn msg;","outputs":1,"x":964.2856903076172,"y":412.8571447134018,"z":"472cf557.b8d30c","wires":[[]]},{"id":"7b72cb4.f848d34","type":"function","name":"test and set busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nif (typeof context.global.busy === \"undefined\") {\n\tcontext.global.busy=true;\n\tmsg.freeToRun=true;\n} else {\n\tif(context.global.busy){\n\t\tmsg.freeToRun=false;\t\t\t// prevent further execution\n\t} else {\n\t\tcontext.global.busy=true;\n\t\tmsg.freeToRun=true;\n\t}\n}\nreturn msg;","outputs":1,"x":158.3333511352539,"y":385.00002574920654,"z":"6b6420fc.949be","wires":[["bef40875.410bf8"]]},{"id":"bef40875.410bf8","type":"switch","name":"OK to Run?","property":"freeToRun","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":328.33334732055664,"y":386.6666841506958,"z":"6b6420fc.949be","wires":[["8b0a2955.74f5d8"]]},{"id":"59a9c827.a65638","type":"function","name":"set not busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\ncontext.global.busy=false;\nreturn msg;","outputs":1,"x":1036.666648864746,"y":1034.9999961853027,"z":"6b6420fc.949be","wires":[[]]},{"id":"73052b03.8cfad4","type":"delay","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":973.333309173584,"y":821.6666831970215,"z":"6b6420fc.949be","wires":[["59a9c827.a65638"]]},{"id":"48e66f62.b7199","type":"function","name":"test and set busy","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nif (typeof context.global.busy === \"undefined\") {\n\tcontext.global.busy=true;\n\tmsg.freeToRun=true;\n} else {\n\tif(context.global.busy){\n\t\tmsg.freeToRun=false;\t\t\t// prevent further execution\n\t} else {\n\t\tcontext.global.busy=true;\n\t\tmsg.freeToRun=true;\n\t}\n}\nreturn msg;","outputs":1,"x":334.99999237060547,"y":833.3333425521851,"z":"6b6420fc.949be","wires":[["d62bb4a5.29d448"]]},{"id":"d62bb4a5.29d448","type":"switch","name":"OK to Run?","property":"freeToRun","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":363.33333333333326,"y":923.3333333333331,"z":"6b6420fc.949be","wires":[["a43c4e90.5bc3b","cfef43dd.3010c"]]},{"id":"f19af68f.0e6508","type":"function","name":"LEDs OFF","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_OFF\"\nreturn msg;","outputs":1,"x":681.6666666666665,"y":1038.3333333333333,"z":"6b6420fc.949be","wires":[["ec2bb0d.f13d45"]]},{"id":"225ea260.dda15e","type":"function","name":"LEDs ON","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_ON\"\nreturn msg;","outputs":1,"x":699.2380752563477,"y":77.47620677947998,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7","8dde6f43.72219"]]},{"id":"a6118e76.59ee7","type":"mqtt out","name":"","topic":"/arduino/1/incoming","broker":"bdf988ea.420678","x":1048.0952644348145,"y":369.71425342559814,"z":"2520088d.dadff8","wires":[]},{"id":"2a59c6f2.d5a63a","type":"delay","name":"delay 1","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":401.4166603088379,"y":233.63095474243164,"z":"2520088d.dadff8","wires":[["4032e6c5.bfcd18","dffca824.200358","d8955aaa.276aa8","6598872e.9a6778"]]},{"id":"6598872e.9a6778","type":"mqtt out","name":"","topic":"/raspberry/1/incoming","broker":"bdf988ea.420678","x":736.916633605957,"y":491.42859649658203,"z":"2520088d.dadff8","wires":[]},{"id":"4032e6c5.bfcd18","type":"function","name":"Jaw motion","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"JAW_MOTION,4,1\"\nreturn msg;","outputs":1,"x":684.8094635009766,"y":169.3333282470703,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]},{"id":"dffca824.200358","type":"delay","name":"","pauseType":"delay","timeout":"3500","timeoutUnits":"milliseconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":456.3809585571289,"y":402.21430015563965,"z":"2520088d.dadff8","wires":[["26accc47.d95334"]]},{"id":"26accc47.d95334","type":"function","name":"LEDs OFF","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_OFF\"\nreturn msg;","outputs":1,"x":662.5714416503906,"y":596.3810110092163,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]},{"id":"9820749b.67df88","type":"inject","name":"Laugh","topic":"","payload":"LAUGH","payloadType":"string","repeat":"","crontab":"","once":false,"x":106.6190414428711,"y":74.2380895614624,"z":"2520088d.dadff8","wires":[["2a59c6f2.d5a63a","225ea260.dda15e"]]},{"id":"d8955aaa.276aa8","type":"delay","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","x":633.5237731933594,"y":282.80953788757324,"z":"2520088d.dadff8","wires":[["9739f5c9.68c608"]]},{"id":"9739f5c9.68c608","type":"function","name":"LEDs ON","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nmsg.payload=\"LEDS_ON\"\nreturn msg;","outputs":1,"x":772.809497833252,"y":369.7142758369446,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]},{"id":"cee3743d.311c88","type":"function","name":"Translate","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//require('util');\n\nvar    servoXMin=200; // 13 The commented numbers are for the old pan/tilt set\nvar    servoXMax=520; // 133\nvar    servoXMid=360; // 73\nvar    servoYMin=235; // 33\nvar     servoYMax=520; // 80\nvar    servoYMid=320; // 65\n\nvar parts=msg.payload.split(\",\");\n\nvar servoX=0.0;\nvar servoY=0.0;\n\n    var X=Math.floor(servoXMid-parts[0]*180);    // Allow for calibration\n    if(X<servoXMin)                 \t  // The skull is heavy. not too big turns\n        servoX=servoXMin;\n    else if (X>servoXMax)\n        servoX=servoXMax;\n    else\n        servoX=X;\n\n    var Y=Math.floor(servoYMid-parts[1]*180-20);     // I subtract 20 since the skull is mounted with a low pitch\n    if(Y<servoYMin)                 \t\t // The skull is heavy. Not too big pitch\n        servoY=servoYMin;\n    else if (Y>servoYMax)\n        servoY=servoYMax;\n    else\n        servoY=Y;\n\ncontext.global.servoY=servoY;\ncontext.global.servoX=servoX;\n\n\nmsg.payload=util.format(\"SERVOS_MOVE,%d,%d,3\",servoX,servoY);\n\nreturn msg;","outputs":1,"x":785.523853302002,"y":705.5238437652588,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]},{"id":"11d1f2ea.ee2e0d","type":"inject","name":"lefttup","topic":"/minecraft/world/facetracker/45,34","payload":"-0.5,0.5","payloadType":"string","repeat":"","crontab":"","once":false,"x":97.6666488647461,"y":393.0952453613281,"z":"2520088d.dadff8","wires":[["cee3743d.311c88"]]},{"id":"a25028c2.5dafd8","type":"inject","name":"rightup","topic":"/minecraft/world/facetracker/45,34","payload":"0.5,0.5","payloadType":"string","repeat":"","crontab":"","once":false,"x":98.38093566894531,"y":448.3809814453125,"z":"2520088d.dadff8","wires":[["cee3743d.311c88"]]},{"id":"fd08408a.02f7c","type":"inject","name":"","topic":"","payload":"GOODBYE","payloadType":"string","repeat":"","crontab":"","once":false,"x":107.14285659790039,"y":150.00000381469727,"z":"2520088d.dadff8","wires":[["2a59c6f2.d5a63a","225ea260.dda15e"]]},{"id":"ce85678c.317a98","type":"inject","name":"","topic":"","payload":"HELLO","payloadType":"string","repeat":"","crontab":"","once":false,"x":107.14284896850586,"y":219.99998950958252,"z":"2520088d.dadff8","wires":[["2a59c6f2.d5a63a","225ea260.dda15e"]]},{"id":"c40ca095.3bf36","type":"inject","name":"","topic":"","payload":"LEFT","payloadType":"string","repeat":"","crontab":"","once":false,"x":264.92859268188477,"y":607.5000095367432,"z":"2520088d.dadff8","wires":[["8a3009a0.75cff8"]]},{"id":"c12236b1.3eddc8","type":"inject","name":"","topic":"","payload":"RIGHT","payloadType":"string","repeat":"","crontab":"","once":false,"x":441.4523696899414,"y":606.1587612628937,"z":"2520088d.dadff8","wires":[["8a3009a0.75cff8"]]},{"id":"18606a78.e79f96","type":"inject","name":"","topic":"","payload":"UP","payloadType":"string","repeat":"","crontab":"","once":false,"x":338.7142677307129,"y":546.2500076293945,"z":"2520088d.dadff8","wires":[["8a3009a0.75cff8"]]},{"id":"64872c2e.9b78d4","type":"inject","name":"","topic":"","payload":"DOWN","payloadType":"string","repeat":"","crontab":"","once":false,"x":361.82541275024414,"y":665.2578830718994,"z":"2520088d.dadff8","wires":[["8a3009a0.75cff8"]]},{"id":"8dde6f43.72219","type":"debug","name":"","active":true,"complete":"true","x":1112.857177734375,"y":202.8571434020996,"z":"2520088d.dadff8","wires":[]},{"id":"ae32ccf7.51cd3","type":"debug","name":"","active":true,"complete":"true","x":983.3333015441895,"y":794.4444417953491,"z":"2520088d.dadff8","wires":[]},{"id":"8a3009a0.75cff8","type":"function","name":"moveskull","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\nvar    servoXMin=200; // 13 The commented numbers are for the old pan/tilt set\nvar    servoXMax=520; // 133\nvar    servoXMid=360; // 73\nvar    servoYMin=235; // 33\nvar     servoYMax=520; // 80\nvar    servoYMid=320; // 65\n\nvar servoX=0.0;\nvar servoY=0.0;\n\nvar X=context.global.servoX;  \nvar Y=context.global.servoY;\n\n// Do the changes that the command suggests\nif(msg.payload==\"UP\")\n\tY=Y-20; \nif(msg.payload==\"DOWN\")\n\tY=Y+20; \nif(msg.payload==\"LEFT\")\n\tX=X+20; \nif(msg.payload==\"RIGHT\") \n\tX=X-20; \n\n    \n    if(X<servoXMin)                 \t  // The skull is heavy. not too big turns\n        servoX=servoXMin;\n    else if (X>servoXMax)\n        servoX=servoXMax;\n    else\n        servoX=X;\n\n\tif(Y<servoYMin)                 \t\t // The skull is heavy. Not too big pitch\n        servoY=servoYMin;\n    else if (Y>servoYMax)\n        servoY=servoYMax;\n    else\n        servoY=Y;\n\ncontext.global.servoY=servoY;\ncontext.global.servoX=servoX;\n\nmsg.payload=util.format(\"SERVOS_MOVE,%d,%d,3\",servoX,servoY);\n\n\nreturn msg;","outputs":1,"x":741.1111111111111,"y":797.7777777777777,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7","ae32ccf7.51cd3"]]},{"id":"5475749.fab8a8c","type":"inject","name":"LEDS_ON","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":106,"y":283,"z":"2520088d.dadff8","wires":[["9739f5c9.68c608"]]},{"id":"8567748a.7a9888","type":"inject","name":"LEDS_OFF","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":105,"y":337,"z":"2520088d.dadff8","wires":[["26accc47.d95334"]]},{"id":"28106934.d7ef96","type":"inject","name":"blink eyes","topic":"","payload":"BLINK,9","payloadType":"string","repeat":"","crontab":"","once":false,"x":98.88888549804688,"y":517.7777919769287,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]},{"id":"44ca7511.bb358c","type":"inject","name":"Clouse mouth","topic":"","payload":"JAW_POSITION,0","payloadType":"string","repeat":"","crontab":"","once":false,"x":118.75,"y":681.2500085830688,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]},{"id":"957206dc.6a8df8","type":"inject","name":"Open mouth","topic":"","payload":"JAW_POSITION,1","payloadType":"string","repeat":"","crontab":"","once":false,"x":113.75,"y":746.2500114440918,"z":"2520088d.dadff8","wires":[["a6118e76.59ee7"]]}]